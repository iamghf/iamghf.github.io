<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="流量劫持技术分析, 网络,树莓派,编程,Java,大数据,Flink,ChatGPT">
    <meta name="description" content="我折腾 我快乐">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>流量劫持技术分析 | ghf</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>
    <script>
		var _hmt = _hmt || [];
		(function() {
		  var hm = document.createElement("script");
		  hm.src = "https://hm.baidu.com/hm.js?c1b480119ac4758bb84d4885b5046e83";
		  var s = document.getElementsByTagName("script")[0]; 
		  s.parentNode.insertBefore(hm, s);
		})();
	</script>

    <!-- Clarity tracking code for https://iamghf.top/ -->
    <script>
        (function(c,l,a,r,i,t,y){
            c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
            t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i+"?ref=bwt";
            y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
        })(window, document, "clarity", "script", "j9amie3njm");
    </script>

<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="ghf" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">ghf</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="https://iamghf.top/wiki" class="waves-effect waves-light">
      
      <i class="fas fa-list" style="zoom: 0.6;"></i>
      
      <span>Wiki</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>

<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">ghf</div>
        <div class="logo-desc">
            
            我折腾 我快乐
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="https://iamghf.top/wiki" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-list"></i>
			
			Wiki
		</a>
          
        </li>
        
        
    </ul>
</div>

        </div>

        
    </nav>

</header>

    
<script src="/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('请输入访问本文章的密码')).toString(CryptoJS.enc.Hex)) {
                alert('密码错误，将返回主页！');
                location.href = '/';
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/21.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">流量劫持技术分析</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="container content">

    
    <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/%E6%B5%81%E9%87%8F%E5%8A%AB%E6%8C%81/">
                                <span class="chip bg-color">流量劫持</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF/" class="post-category">
                                网络技术
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2019-10-14
                </div>
                

                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    4.5k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    15 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>

        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="流量劫持技术分析"><a href="#流量劫持技术分析" class="headerlink" title="流量劫持技术分析"></a>流量劫持技术分析</h1><p>万物互联时代，无线网络全面覆盖我们的生活，基本上各家门店都有wifi标志，而且有的还没有密码，蹭WiFi似乎已成为一项基本“生存技能”，现代人的基本状态就像下面这首打油诗一样：</p>
<p>枯藤老树昏鸦，空调Wifi西瓜</p>
<p>葛优同款沙发，我就往那一趴</p>
<p>如果企业没有对自家应用做好数据防护，蹭网的同时，用户个人隐私也暴露在互联网中，不安全协议传输数据，直接导致用户数据被中间人劫持获取。</p>
<p>同时，流量被劫持获取，可以直接对服务器发起攻击，获取服务器业务数据、用户数据等核心资产信息。那么企业应该如何去避免此类攻击的发生呢？首先得去了解一下中间人攻击的前因后果。</p>
<p><strong>中间人攻击的前因后果</strong></p>
<p><strong>协议先天性缺陷</strong></p>
<p><strong>（1）HTTP明文传输导致用户信息泄露？</strong></p>
<p>从攻击的视频中可以知道，攻击者是实施了HTTP协议的中间人攻击，相信每个计算机行业人员都知道，超文本传输协议（HTTP，HyperText TranSfer Protocol）是互联网上应用最为广泛的一种网络协议，所有的WWW文件都必须遵守这个标准，也就是说万维网不得不使用这个协议，也是非常的尴尬。</p>
<p><strong>从攻击者的角度是怎么看待这个问题呢？</strong></p>
<p>寻找一个采用HTTP协议传输数据的网站系统，这里针对用户登录的账号信息进行数据获取，使用WireShark流量分析工具对局域网下的用户HTTP数据包进捕获，参考下图：</p>
<p><img src="https://img.iamghf.top/blog/2019-12-26-121924.jpg" alt="流量劫持技术分析！传输协议不安全，数据泄露谁之过？"></p>
<p>对TCP数据流进行数据分析，可以发现，存在明文的用户名uname和密码password，参考下图：</p>
<p><img src="https://img.iamghf.top/blog/2019-12-26-121935.jpg" alt="流量劫持技术分析！传输协议不安全，数据泄露谁之过？"></p>
<p><strong>总结：由此可见HTTP数据流是用明文方式传输数据，攻击者可以利用局域网抓包等手段轻易获取用户与服务器的交互信息。</strong> </p>
<p><strong>（2）为什么HTTP是明文传输？</strong></p>
<p>从上一小节可以知道攻击者抓取的HTTP数据包里面的数据是明文，为了解明文传输的原理，可以先了解以下在OSI七层模型中HTTP协议工作的地方，OSI模型七个层次的功能以及协议集图示如下：</p>
<p><img src="https://img.iamghf.top/blog/2019-12-26-121943.png" alt="流量劫持技术分析！传输协议不安全，数据泄露谁之过？"></p>
<p>根据OSI七层模型，可以知道HTTP协议工作在应用层，再来看看HTTP数据包的封装过程，发送方在客户端页面输入上层数据，上层数据到传输层会添加TCP报头形成数据段，再下送到网络层添加IP报头形成数据段，在继续下送至数据链路层添加以太网首部和尾部，形成以太网帧，最后传递至物理层形成01010形式的比特流，整个过程，上层数据这一部分没有进行任何加密数据处理，参考下图：</p>
<p><img src="https://img.iamghf.top/blog/2019-12-26-121952.png" alt="流量劫持技术分析！传输协议不安全，数据泄露谁之过？"></p>
<p>同理接收方也是如此，接受方收到二进制比特流，通过层层上送解包，最终获取明文的上层数据，参考下图：</p>
<p><img src="https://img.iamghf.top/blog/2019-12-26-121957.png" alt="流量劫持技术分析！传输协议不安全，数据泄露谁之过？"></p>
<p><strong>总结：HTTP虽然是应用层的协议，但是其数据在整个数据装包中都是处于明文状态，只是不同层次之间进行了包的封装转换，在不同层次会看到不同的数据，比如在物理层，只能看到0101010类型的二进制比特流，但是在应用层却可以看到明文的数据，整个过程只是一个数据包的封装和解包，没有设计数据的加密和解密操作。</strong></p>
<p><strong>（3）中间人攻击的根源是什么？</strong></p>
<p>通过了解HTTP明文传输的分析过后，结合OSI七层模型每一层的含义，参考如下：</p>
<p><img src="https://img.iamghf.top/blog/2019-12-26-122005.png" alt="流量劫持技术分析！传输协议不安全，数据泄露谁之过？"></p>
<p>路由器是存在于OSI七层模型的网络层，也就是通常接触最多的局域网，家里接入有线或者无线网络都会设置路由器，用户通过接入路由器与外界网络进行联系。</p>
<p>中间人攻击也是在这一层面实施攻击的，这一层存在的协议参考OSI七层模型可以知道有IP，ARP，ICMP等协议。在路由器层面，也就是局域网内是通过地址解析协议即ARP（AddreSS ReSolution Protocol），根据IP地址获取物理地址进行目标寻址交流。大概的流程内容如下：</p>
<ul>
<li>主机发送信息时将包含目标IP地址的ARP请求广播到网络上的所有主机，并接收返回消息，以此确定目标的物理地址；</li>
<li>收到返回消息后将该IP地址和物理地址存入本机ARP缓存中并保留一定时间，下次请求时直接查询ARP缓存以节约资源。</li>
</ul>
<p>ARP协议没有安全认证机制，因为局域网内主机是建立在信任的基础上的，所以只要主机接收到ARP应答包，都会缓存在ARP表中，这就为ARP欺骗提供了可能。攻击者可以发送错误的IP地址MAC地址的映射关系。</p>
<p>ARP欺骗主机等攻击是最常见的中间人攻击，在同一个局域网中，通过将网卡设置为混杂模式，借助ARP欺骗实现中间人攻击即可监听目标设备的网络通信。ARP攻击原理如下图：</p>
<p><img src="https://img.iamghf.top/blog/2019-12-26-122010.jpg" alt="流量劫持技术分析！传输协议不安全，数据泄露谁之过？"></p>
<p><img src="https://img.iamghf.top/blog/2019-12-26-122018.png" alt="流量劫持技术分析！传输协议不安全，数据泄露谁之过？"></p>
<p>主机A IP:192.168.1.2 MAC:02-02-02-02-02-02</p>
<p>主机B IP:192.168.1.3 MAC:03-03-03-03-03-03</p>
<p>网关 IP:192.168.1.1 MAC:01-01-01-01-01-01</p>
<p>主机B为攻击者，向被攻击者主机A不断发送ARP响应数据包内容：IP：192.168.1.1对应MAC：03-03-03-03-03-03 向网关不断发送ARP响应包内容：192.168.1.2对应MAC：03-03-03-03-03-03，在局域网内，广播寻址是根据MAC地址来定位用户地址的，所以，一旦mac地址进行了改变，用户地址也就进行了改变，由于ARP会更新缓存表的特性，导致了攻击者可以通过不断发送ARP响应包达到欺骗网关和被攻击者的目的，代替用户与网关进行信息交互，同时代替网关与用户联系，进而形成了中间人攻击。</p>
<p><strong>总结：ARP缓存接受任何时间更新成为中间人攻击的根本原因</strong></p>
<p><strong>安全协议不安全</strong></p>
<p><strong>（1）HTTPS加密传输也存在信息泄漏？</strong></p>
<p>开发人员针对部分不安全协议进行了安全控制，采用HTTP+SSL的方式进行数据传输，也就是我们常说的HTTPS协议。使用安全套接字层（SSL）进行信息交换，简单来说就是HTTP的安全版，来保证传输的数据安全。</p>
<p>从攻击者的角度是怎么看待这个问题呢？</p>
<p>可以通过实验来看结果，选择QQ邮箱登录网站，该网站使用HTTPS，使用WireShark抓包查看TCP数据量</p>
<p><img src="https://img.iamghf.top/blog/2019-12-26-122024.jpg" alt="流量劫持技术分析！传输协议不安全，数据泄露谁之过？"></p>
<p>追踪TCP数据流，数据全是乱码，无法识别数据，很明显数据已经被加密了，通过抓包并没有获取用户信息。</p>
<p>到这里一定会存在一个疑问，如果我的App与服务器全部采用HTTPS通信不就没有中间人攻击的问题了吗？</p>
<p>事实上如果用自己伪造的CA证书去加解密数据包，一样可以获取到敏感信息，大致攻击思路：攻击者在设备上导入并信任自己的CA证书，然后利用该证书进行数据的加密和解密，在这个过程中，明文信息已经被暴露在攻击者面前。</p>
<p>比如这里，将CA证书导入设备让其信任，使用工具抓包，能够清晰看见HTTPS数据包的信息。同样是qq邮箱登录的数据，区别就在于使用工具之前我让设备信任了自己的CA证书。当然这里并没有抓到明文密码，这是由于qq邮箱还有其他数据安全加密设置，参考下图：</p>
<p><img src="https://img.iamghf.top/blog/2019-12-26-122029.jpg" alt="流量劫持技术分析！传输协议不安全，数据泄露谁之过？"></p>
<p><strong>总结：HTTPS证书信任机制出现问题，还是可以进行中间人攻击截取用户明文的数据流量。</strong></p>
<p><strong>（2）HTTPS为什么存在安全风险？</strong></p>
<p>从上一节可以了解到，HTTPS加密协议也是存在中间人攻击的，为了解攻击的原理，我们可以先来看一看HTTPS的握手过程。这里以支付宝为例，利用WireShark获取支付宝的HTTPS数据流量进行分析</p>
<p><img src="https://img.iamghf.top/blog/2019-12-26-122035.jpg" alt="流量劫持技术分析！传输协议不安全，数据泄露谁之过？"></p>
<p>客户端发送Client Hello请求建立HTTPS链接，服务器返回Server Hello回应客户端接收到请求，并下发HTTPS证书给客户进行验证，客户端验证通过，发送对称加密密钥，进行数据交换。能够非常直观的看出握手流程，简单的HTTPS实现图</p>
<p><img src="https://img.iamghf.top/blog/2019-12-26-122040.png" alt="流量劫持技术分析！传输协议不安全，数据泄露谁之过？"></p>
<p>如果客户端未严格校验证书或者忽略了域名校验，攻击者可以通过对客户端进行操作，从而绕过客户端的弱校验，达到欺骗服务器，进行中间人攻击的目的。简单例举了HTTPS存在的问题</p>
<ul>
<li>忽略SSL证书校验</li>
<li>忽略域名校验</li>
<li>证书信息泄漏</li>
</ul>
<p>情况一、信任任何证书。出现这种情况的原因很有可能是使用的开源通信库存在缺陷，还有就是开发人员在开发过程中未连接生产环境的服务器，为解决认证过程中证书报错的问题只能暂时修改代码使其APP信任任意证书，而在上线前未对此代码进行处理。通过对APP进行逆向分析，可以在客户端代码中发现存在开发人员忽略证书认证的代码片段</p>
<p><img src="https://img.iamghf.top/blog/2019-12-26-122045.png" alt="流量劫持技术分析！传输协议不安全，数据泄露谁之过？"></p>
<p>该段代码重写了谷歌原有X509Certificate[]的校验方式，进行了覆盖，却没有添加自己的证书校验代码，导致证书校验的代码为空，攻击者可以使用任意证书进行流量劫持，这里利用了工具自签名一个证书，即可进行HTTPS证书校验绕过，参考下图：</p>
<p><img src="https://img.iamghf.top/blog/2019-12-26-122051.jpg" alt="流量劫持技术分析！传输协议不安全，数据泄露谁之过？"></p>
<p>情况二、信任证书管理机构（CA）颁发的证书。这种情况的APP可以信任任何CA颁发的证书，据说这类的证书只需50美元就能买到。此类问题出在AFNetworking 2.5.2及之前的版本，也就是说如果某APP使用了此版本的开源通信库，在不安全Wifi网络中的黑客、VPN网络中的职工或者国家支持的黑客，只要使用CA颁发的证书就可以对该APP的HTTPS加密数据进行监听或者篡改，在源代码中发现配置代码片段：</p>
<p><img src="https://img.iamghf.top/blog/2019-12-26-122058.png" alt="流量劫持技术分析！传输协议不安全，数据泄露谁之过？"></p>
<p>该段代码一个重要的配置ALLOW_ALL_HOSTNAME_VERIFIER,使其信任官方的CA证书，无论是颁发给谁的，只要是官方的证书，都可以信任，从而导致验证失败。</p>
<p>情况三、信任合法证书。这种情况的APP只信任对自己而言合法的证书，首先我们看一下SSL认证的原理的前三步：1、客户端向服务器传送客户端SSL协议的版本号，加密算法的种类，产生的随机数，以及其他服务器和客户端之间通讯所需要的各种信息。2、服务器向客户端传送SSL协议的版本号，加密算法的种类，随机数以及其他相关信息，同时服务器还将向客户端传送自己的证书。3、客户端利用服务端传过来的信息验证服务器的合法性，服务器的合法性包括：证书是否过期，发行服务器证书的CA是否可靠，发行者证书的公钥能否正确解开服务器证书的“发行者的数字签名”，服务器证书上的域名是否和服务器的实际域名相匹配。如果合法性验证没有通过，通讯将断开；如果合法性验证通过，将继续进行下一步。那么如何让APP信任非法的证书呢，看上文说到的3步，我们只需要做到在合法性验证的时候能够欺骗APP，通讯就不会中断。在手机本地添加一个信任证书，APP在本地验证的时候，由于手机信任该证书，APP默认也信任该证书，达到欺骗APP的目的。</p>
<p>情况四、这种情况是采用了服务器和客户端双向认证的措施，即客户端在确认服务器是否合法之后，服务器也要确认客户端是否是合法的（服务器要求客户发送客户自己的证书。收到后，服务器验证客户的证书，如果没有通过验证，拒绝连接；如果通过验证，服务器获得用户的公钥）。正是这个原因，我们在测试APP时会发现尽管我们信任了burp或者fiddler的证书，可是在进行登录操作时APP依然会显示网络连接错误，此时服务端已经知道客户端可能是非法的，然后拒绝连接。如果你是开发人员，想分析HTTPS流量也很简单：使用burp导入客户端证书，此时burp就可以与服务器正常的建立连接，你也可以正常的截取到数据包了，只要获取到证书以及密钥，即可进行数据获取。APP开发时，在本地实现证书导入，应用于HTTPS双向校验传输证书的密钥可以在本地获取，参考实现代码片段</p>
<p><img src="https://img.iamghf.top/blog/2019-12-26-122105.png" alt="流量劫持技术分析！传输协议不安全，数据泄露谁之过？"></p>
<p>分析上例代码可以发现，应用于证书client.p12的密钥，猜测在he.b()/he.a()函数中会进行一个处理，利用hook技术，对函数内容进行hook，即可获取字符串信息，该信息包括了密钥和其他的数据，利用获取的密钥和本地保存的client.p12证书，即可模拟开发人员进行HTTPS双向验证，截取用户明文信息。</p>
<p>两者代码片段分别如下</p>
<p><img src="https://img.iamghf.top/blog/2019-12-26-122110.png" alt="流量劫持技术分析！传输协议不安全，数据泄露谁之过？"></p>
<p><strong>总结：HTTPS安全协议不安全，主要还是在设计阶段选择了单向校验，在加上后期没有进行严格的证书校验，导致HTTPS证书验证被绕过，其次就是采用了双向校验，但是本地校验的代码没有进行安全保护，攻击者通过动态HOOK，也是可以获取CA证书以及其密钥信息。</strong></p>
<p><strong>（3）HTTPS中间人攻击的危害？</strong></p>
<p>HTTPS虽然也存在中间人攻击，但是和ARP局域网攻击又存在很大的差别，参考下图：</p>
<p><img src="https://img.iamghf.top/blog/2019-12-26-122117.jpg" alt="流量劫持技术分析！传输协议不安全，数据泄露谁之过？"></p>
<p>ARP欺骗，数据信息攻击获取范围是介于路由器和用户手机之间，也就是OSI模型的数据链路层，路由器和用户手机之间传输的信息都可能被攻击者截取，通过中间人攻击获取在同一局域网下所有用户的数据流量</p>
<p>SSL欺骗，SSL是位于OSI模型的传输层和应用层之间，可以通过绕过APP本地校验机制实现在传输层和应用层之间的数据传输（数据到达应用层，也就是给用户的展示界面是明文的）截取，从而获取明文数据，或者是HTTPS相关的密钥信息。仅存在用户自己手机内部，只能获取攻击者本身操作的账户流量信息</p>
<p>总结：就攻击范围来讲，在客户端的攻击HTTPS攻击是影响面比较窄，但就针对服务端的攻击影响来看，两者是一致的，都可以操作服务端数据，获取服务端信息，都能危及服务器安全。</p>
<p><strong>几维安全解决方案</strong></p>
<p>应对传输协议缺陷，流量被劫持的安全风险，几维安全建议以协议安全，数据安全，应用代码安全为目标来应对中间人攻击。</p>
<p>首先对客户端APP的可执行文件DEX、SO、Mach-O被破解的风险，几维安全采用源代码保护技术，对DEX文件进行JAVA2C，将JAVA代码下沉至Native层，并在该层对转化后的伪C代码进行强度最高的虚拟化处理，对SO和Mach-O文件采用源代码编译的方式，直接把C/C++/Object-C/Swift工程项目编译成KiwiVM虚拟化后的结果，保障客户的不被攻击者逆向破解。</p>
<p>其次对在终端设备运行的客户端运行时会在内存中传递重要的数据，通过接入几维安全防御安全SDK，可以对手机环境，进程防护，代码注入等方面进行全面的检测和防护，保证本地内存数据不遭受恶意篡改。</p>
<p>同时，针对通道存在的明文传输和协议破解伪造风险，几维安全提供结合<a href="https://www.kiwisec.com/product/KiwiVM-iot.html" target="_blank" rel="noopener">代码虚拟化技术</a>和白盒技术研发的白盒密钥SDK。利用SDK对传输的数据和存储的数据进行高强度的加密，且提供动态加密、数据完整性校验等功能，支持多种对称加密、非对称加密和哈希算法，严格保障了数据的完整性和保密性。</p>
<p><img src="https://img.iamghf.top/blog/2019-12-26-122124.jpg" alt="流量劫持技术分析！传输协议不安全，数据泄露谁之过？"></p>

            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://iamghf.top" rel="external nofollow noreferrer">ghf</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://iamghf.top/liu-liang-jie-chi-ji-zhu-fen-xi.html">https://iamghf.top/liu-liang-jie-chi-ji-zhu-fen-xi.html</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="https://iamghf.top" target="_blank">ghf</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/%E6%B5%81%E9%87%8F%E5%8A%AB%E6%8C%81/">
                                    <span class="chip bg-color">流量劫持</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">

<div id="article-share">
    
    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">one for all, all for one</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.png" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>
            
        </div>
    </div>

    
        <link rel="stylesheet" href="/libs/gitalk/gitalk.css">
<link rel="stylesheet" href="/css/my-gitalk.css">

<div class="card gitalk-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; padding-left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="gitalk-container" class="card-content"></div>
</div>

<script src="/libs/gitalk/gitalk.min.js"></script>
<script>
    let gitalk = new Gitalk({
        clientID: '7140a41ed2ddd46c10c7',
        clientSecret: '9f81b92236315959b71eb3c245a4f02f922a7651',
        repo: 'xjbsay',
        owner: 'iamghf',
        admin: "iamghf",
        id: '2019-10-14T16-47-39',
        distractionFreeMode: false  // Facebook-like distraction free mode
    });

    gitalk.render('gitalk-container');
</script>

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/ren-sheng-ku-duan-wo-yong-pycharm.html">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/17.jpg" class="responsive-img" alt="人生苦短，我用PyCharm">
                        
                        <span class="card-title">人生苦短，我用PyCharm</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            人生苦短，我用PyCharm导读：PyCharm 是一种 Python IDE，可以帮助程序员节约时间，提高生产效率。那么具体如何使用呢？本文从 PyCharm 安装到插件、外部工具、专业版功能等进行了一一介绍，希望能够帮助到大家。
在本文
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2019-10-14
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E8%BD%AF%E4%BB%B6%E7%B3%BB%E7%BB%9F/" class="post-category">
                                    软件系统
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/python/">
                        <span class="chip bg-color">python</span>
                    </a>
                    
                    <a href="/tags/pycharm/">
                        <span class="chip bg-color">pycharm</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/ru-he-chao-guo-da-duo-shu-ren.html">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/2.jpg" class="responsive-img" alt="如何超过大多数人">
                        
                        <span class="card-title">如何超过大多数人</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            当你看到这篇文章的标题，你一定对这篇文章产生了巨大的兴趣，因为你的潜意识在告诉你，这是一本人生的“武林秘籍”，而且还是左耳朵写的，一定有干货满满，只要读完，一定可以练就神功并找到超过大多数人的快车道和捷径……然而…… 当你看到我这样开篇时，
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2019-09-27
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E8%B6%A3%E9%97%BB/" class="post-category">
                                    趣闻
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E6%88%90%E9%95%BF/">
                        <span class="chip bg-color">成长</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->


<!-- 代码块收缩 -->


<!-- 代码块折行 -->

<style type="text/css">
code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }
</style>


    

</main>



    <footer class="page-footer bg-color">
    
    <div class="container row center-align" style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            <span id="year">2019</span>
            <a href="https://iamghf.top" target="_blank">ghf</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <br>
            
            <span id="icp"><img src="/medias/icp.png" style="vertical-align: text-bottom;" />
                <a href="http://www.beian.miit.gov.cn/" target="_blank">湘ICP备18008192号-1</a>
            </span>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/iamghf" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:841567545@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=841567545" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 841567545" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("/" + "search.xml", 'searchInput', 'searchResult');
});
</script>
    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

<script>
    var _hmt = _hmt || [];
    (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?c1b480119ac4758bb84d4885b5046e83";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    

    

    
    
    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
